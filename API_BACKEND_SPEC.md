# API Backend Спецификация для приложения учёта расходов

## Базовый URL
```
https://your-backend-url.com/api
```

## Эндпоинты

### 1. Генерация категории для расхода

**POST** `/expenses/generate-category`

Генерирует категорию для расхода на основе описания и суммы с использованием AI.

#### Request Body
```json
{
  "description": "Купил продукты в магазине",
  "amount": 1500.0
}
```

#### Response
```json
{
  "category": "Продукты и питание"
}
```

#### Параметры запроса
- `description` (string, обязательный) - текстовое описание расхода
- `amount` (double, обязательный) - сумма расхода

#### Параметры ответа
- `category` (string) - сгенерированная AI категория расхода

#### Коды ответа
- `200 OK` - успешная генерация категории
- `400 Bad Request` - некорректные параметры запроса
- `500 Internal Server Error` - ошибка на сервере

---

### 2. Анализ расходов

**POST** `/expenses/analyze`

Анализирует список расходов пользователя и предоставляет детальную статистику и рекомендации.

#### Request Body
```json
[
  {
    "id": "uuid-1",
    "amount": 1500.0,
    "category": "Продукты и питание",
    "description": "Купил продукты в магазине",
    "date": "2025-12-07T14:30:00",
    "isGeneratingCategory": false
  },
  {
    "id": "uuid-2",
    "amount": 500.0,
    "category": "Транспорт",
    "description": "Такси до работы",
    "date": "2025-12-07T08:00:00",
    "isGeneratingCategory": false
  }
]
```

#### Response
```json
{
  "totalAmount": 2000.0,
  "categoryBreakdown": {
    "Продукты и питание": 1500.0,
    "Транспорт": 500.0
  },
  "averageExpense": 1000.0,
  "topCategory": "Продукты и питание",
  "recommendations": [
    "Попробуйте сократить расходы на категорию 'Продукты и питание'",
    "Рассмотрите возможность использования бюджета"
  ],
  "summary": "Ваши расходы за период составили 2000.00 ₽. Основная категория расходов - Продукты и питание."
}
```


#### Параметры запроса
- Массив объектов `Expense` с полями:
  - `id` (string) - уникальный идентификатор расхода
  - `amount` (double) - сумма расхода
  - `category` (string, nullable) - категория расхода
  - `description` (string) - описание расхода
  - `date` (string, ISO 8601) - дата и время расхода
  - `isGeneratingCategory` (boolean) - флаг генерации категории

#### Коды ответа
- `200 OK` - успешный анализ
- `400 Bad Request` - некорректные параметры запроса
- `500 Internal Server Error` - ошибка на сервере

---

### 3. Чат с AI ассистентом

**POST** `/chat`

Отправляет сообщение в чат с AI для обсуждения расходов. AI имеет контекст расходов пользователя и истории чата.

#### Request Body
```json
{
  "message": "Расскажи подробнее о моих расходах на продукты",
  "expenses": [
    {
      "id": "uuid-1",
      "amount": 1500.0,
      "category": "Продукты и питание",
      "description": "Купил продукты в магазине",
      "date": "2025-12-07T14:30:00",
      "isGeneratingCategory": false
    }
  ],
  "chatHistory": [
    ["Привет", "Здравствуйте! Я AI-ассистент по анализу расходов."],
    ["Сколько я потратил?", "Общая сумма ваших расходов составляет 1500.00 ₽"]
  ]
}
```

#### Response
```json
{
  "message": "Вы потратили 1500.00 ₽ на продукты и питание. Это ваша основная категория расходов. Рекомендую планировать покупки заранее и составлять список продуктов, чтобы избежать импульсивных покупок и сэкономить до 20% от суммы."
}
```

#### Параметры запроса
- `message` (string, обязательный) - сообщение от пользователя
- `expenses` (array) - массив расходов для контекста
- `chatHistory` (array of pairs, опциональный) - история предыдущих сообщений в формате [["user message", "ai response"], ...]

#### Параметры ответа
- `message` (string) - ответ от AI ассистента

#### Коды ответа
- `200 OK` - успешный ответ
- `400 Bad Request` - некорректные параметры запроса
- `500 Internal Server Error` - ошибка на сервере

---

## Модель данных

### Expense
```kotlin
data class Expense(
    val id: String,                    // UUID расхода
    val amount: Double,                // Сумма расхода
    val category: String?,             // Категория (nullable, может быть null во время генерации)
    val description: String,           // Описание расхода
    val date: LocalDateTime,           // Дата и время (ISO 8601 формат)
    val isGeneratingCategory: Boolean  // Флаг процесса генерации категории
)
```

### ExpenseAnalysis
```kotlin
data class ExpenseAnalysis(
    val totalAmount: Double,                        // Общая сумма всех расходов
    val categoryBreakdown: Map<String?, Double>,    // Разбивка по категориям
    val averageExpense: Double,                     // Средний расход
    val topCategory: String?,                       // Топ категория
    val recommendations: List<String>,              // Список рекомендаций
    val summary: String                             // Краткое резюме анализа
)
```

---

## Примечания для разработки бэкенда

1. **Генерация категорий**: Используйте AI (например, GPT) для интеллектуальной классификации расходов на основе описания и суммы.

2. **Анализ расходов**: Возвращает структурированный JSON с детальной статистикой и рекомендациями.

3. **Чат**: AI должен анализировать контекст расходов и историю чата для предоставления персонализированных советов.

4. **Безопасность**: 
   - Реализуйте аутентификацию (например, JWT tokens)
   - Добавьте rate limiting для защиты от злоупотреблений
   - Валидируйте все входящие данные

5. **Обработка ошибок**: Возвращайте понятные сообщения об ошибках в JSON формате:
   ```json
   {
     "error": "Invalid request parameters",
     "details": "Amount must be a positive number"
   }
   ```

6. **Производительность**: 
   - Кэшируйте частые запросы
   - Используйте асинхронную обработку для AI запросов
   - Оптимизируйте запросы к базе данных

---

## Примеры категорий для AI

Рекомендуемые категории для классификации:
- Продукты и питание
- Транспорт
- Развлечения
- Здоровье
- Одежда и обувь
- Коммунальные услуги
- Образование
- Крупные покупки
- Мелкие расходы
- Прочее

AI может создавать и другие категории на основе контекста.

